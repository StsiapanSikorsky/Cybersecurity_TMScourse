# Домашнее задание 6 - Криптография
1) Изучить этапы, методы и протоколы IPSec  
- IKE Phase 1  
- IKE Phase 2
- IPSec framework protocols
- HTTP и HTTPS
2) SSH Best Practice
- На VM Ubuntu (KaliLinux) настроить SSH по лучшим практикам
- Сгенерировать на Windows host или KaliLinux VM (ssh-keygen) приватный и публичный ключ, добавить публичный ключ (замок) ssh-add либо scp на Ubuntu VM, где настроить ssh
- Подключиться к Ubuntu VM используя приватный ключ
3) WriteGuard VPN
- Развернуть Ubuntu с 2 сетевыми интерфейсами (один в интернет, другой во внутреннюю сеть в которую подключены WindowsServer и KaliLinux). Настроить на ней возможность подключения по RDP и SSH с WindowsServer на срок неделю
- Установить и настроить WireGuardVPN на Ubuntu
- Установить агент VPN Wireguard на хост машину
- Установить VPN соединение между хостовой машиной и Ubuntu с VPN Wireguard 

### Дополнительные ссылки:
[Что такое IPSec и принцип работы](https://networklessons.com/cisco/ccie-routing-switching/ipsec-internet-protocol-security)  
[Лучшие практики по настройке SSH](https://wiki.merionet.ru/articles/luchshie-praktiki-po-zashhite-ssh-podklyucheniya)  
[Установка и конфигурация WireguardVPN Ubuntu](https://habr.com/ru/sandbox/189100/)  
[Отличие и безопасность HTTP и HTTPS](https://www.cloudflare.com/ru-ru/learning/ssl/why-is-http-not-secure/)  

## 1) Изучение этапов методов и протоколов IPSec
Протокол  IPSec предназначен для защиты интернет трафика на сетевом уровне, в его возможности входит:  
_1_ . Шифрование данных пользователя с использованием протоколов DES, 3DES или AES;  
_2_ . Сохранение принципа целостности данных, а также проверка на изменение данных путем ХЭШИРОВАНИЯ MD5 или SHA;  
_3_ . Проведение аутентификации между устройствами;
_4_ . Защита от передачи дублирующихся пакетов, путем присвоения порядковых номеров.

**Процесс IPSec состоит из пяти этапов:**  
1) Инициализация - когда на маршрутизатор поступают данные, находящиеся в его списке защищенности (при настройке маршрутизатора). В таком случае для безопасной передачи данных маршрутизатор запускает процесс IKE.
2) IKE Phase1 - создание туннеля ISAKMP.
3) IKE Phase2 - создание внутри туннеля ISAKMP туннеля IPSec
4) Завершение

Для применения протокола IPSec необходимо иметь два соттветсвующих IPSec узла, строящих туннель IPSec с применением протокола **IKE(Internet Key Exchange)**
 
 Протокол IKE состоит из 2 этапов:  
 ### 1. IKE Phase 1:
 На первом этапе между двумя узлами происходит согласование используемого шифрования, вида аутентификации, хэширования,применения других протоколов, устанавливается срок службы туннеля (чем короче, тем безопаснее).  

 На данном этапе устанавливается туннель **ISAKMP (Internet Securyty Assotiation and Key Managment Protocol)**, который в свою очередь используется лишь для трафика управления. Данный туннель также используется для создания второго туннеля IKE Phase2 (или IPSec туннеля)  

 Стоит заметить, что построенный IKE туннель не аутентифицирует и не шифрует пользовательские данные, для выполнения данных функций используют следующие протоколы:
 > AH (Заголовок аутентификации)  
 > ESP (Инкапсуляция полезной нагрузки)  

 > [!CAUTION]  
 > Только протокол ESP поддерживает шифрование и в настоящее время является наиболее предпочтительным выбором!

Оба протокола (AH и ESP) поддерживают два разных режима работы:  
_1_ . Transport mode - использует исходный заголовок IP. Данный режим используется между двумя устройствами, хотящими защитить свой трафик (трафик telnet).  
_2_ . Tunnel mode - используется новый заголовок IP. режим используется для VPN типа сеть-сеть, с необходимостью инкапсулирования исходного IP пакета.  

![image](https://networklessons.com/wp-content/uploads/2015/08/ipsec-ah-transport-tunnel-mode-headers.png)  

#### Этапы IKE Phase 1:
- Переговоры (как и говорилось ранее устанавливается время жихни, хеширование, вид шифрования, группа DH, проводится аутентификация).
- Обмен ключами DH (в конечном итоге оба узла будут иметь общий ключ).
- Аутентификация (при прохождении успешной аутентификации, процесс завершается построением ISAKMP туннеля).

> [!WARNING]  
> Данные этапы возможно выполнить в одном из двух режимах  
> А) Основной режим (6 сообщений)  
> Б) Агрессивный режим (3 сообщения)

### 2. IKE Phase 2:
На данном этапе строится туннель IPSec, он используется для защиты пользовательских данных.

На данном этапе роутеры обсуждают следующие вопросы:  
_1_. Протокол IPSec (AH или ESP);  
_2_. Режим инкапсуляции (транспортный или туннельный);  
_3_. Шифрование (DES, 3DES, AES);  
_4_. Аутентификация (MD5, SHA);  
_5_. Срок жизни туннеля IPSec;  
_6_. Обмен DH (необязательно) (используется для PES-совершенная прямая секретность)  










